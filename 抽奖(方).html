<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>好运转转转</title>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <style>
        .lottery_pn {
            position: absolute;
             bottom: 5%;
            font-size: 0.08rem;
             left: 0;
            width: 100%;
        }
    </style>
    <script type="text/javascript" src="./js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="./js/rem.js"></script>
</head>
<body>
    <div class="container">
        <div class="lucky_bar" style="background-color: #fff9b1;">
            <img class="pic_button" src="./images/myprize_button.png" alt="">
            <div class="lottery_zone">
                <!--<img class="lottery_area" src="./images/lottery_decoratiom.png" alt="">-->
                <div id="lottery">
                    <table border="0" cellpadding="0" cellspacing="12">
                        <tr>
                            <td class="lottery-unit lottery-unit-0">
                                <img class="img_sty" src="./images/lottery_thanks.png">
                                <div class="lottery_pn">谢谢参与</div>
                            </td>
                            <td class="lottery-unit lottery-unit-1">
                                <img class="img_sty" src="./images/lottery_thanks.png">
                                <div class="lottery_pn">谢谢参与</div>
                            </td>
                            <td class="lottery-unit lottery-unit-2">
                                <img class="img_sty" src="./images/lottery_thanks.png">
                                <div class="lottery_pn">谢谢参与</div>
                            </td>
                        </tr>
                        <tr>
                            <td class="lottery-unit lottery-unit-7"><img class="img_sty" src="./images/lottery_thanks.png">
                                <div class="lottery_pn">谢谢参与</div></td>
                            <td style="background-color: red;border-radius: 0.04rem;position: relative">
                                <img class="lucky_draw" src="./images/lucky_draw.png" alt="" style="position: absolute;top: 5%;left: 5%; width: 88%;">
                            </td>
                            <td class="lottery-unit lottery-unit-3">
                                <img class="img_sty" src="./images/lottery_thanks.png">
                                <div class="lottery_pn">谢谢参与</div>
                            </td>
                        </tr>
                        <tr>
                            <td class="lottery-unit lottery-unit-6">
                                <img class="img_sty" src="./images/lottery_thanks.png">
                                <div class="lottery_pn">谢谢参与</div>
                            </td>
                            <td class="lottery-unit lottery-unit-5">
                                <img class="img_sty" src="./images/lottery_thanks.png">
                                <div class="lottery_pn">谢谢参与</div>
                            </td>
                            <td class="lottery-unit lottery-unit-4">
                                <img class="img_sty" src="./images/lottery_thanks.png">
                                <div class="lottery_pn">谢谢参与</div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="lottery_tips" style="height: 0.3rem">您还有<span class="lottery_num">3</span>次抽奖机会</div>
            </div>
            <img class="pic_size" src="./images/lottery_square_banner.png" alt="">
        </div>
        <div class="info_zone">
            <div class="winners_list">
                <div class="zjmd">
                    <div class="info_title">
                        <hr width=90% size=3 color=#f2545a align=center noshade style="margin: 0 auto;">
                        <div class="title_capture">中奖名单</div>
                    </div>

                    <div style="margin-top: 0.1rem">
                        <ul>
                            <li>
                                <div class="info_line" style="padding-top: 0.1rem;">
                                    <div class="winners_name floatleft"><p class="line_size"><span style="float: left">恭喜</span><span class="name">XXXXXXXXXX</span></p></div>
                                    <div class="winners_prize floatleft"><p class="line_size"><span style="float: left">获得</span><span class="prize">XXXXXXXXXXX</span></p></div>
                                </div>
                            </li>
                            <li>
                                <div class="info_line">
                                    <div class="winners_name floatleft"><p class="line_size"><span style="float: left">恭喜</span><span class="name">XXXXXXXXXX</span></p></div>
                                    <div class="winners_prize floatleft"><p class="line_size"><span style="float: left">获得</span><span class="prize">XXXXXXXXXXX</span></p></div>
                                </div>
                            </li>
                            <li>
                                <div class="info_line">
                                    <div class="winners_name floatleft"><p class="line_size"><span style="float: left">恭喜</span><span class="name">XXXXXXXXXX</span></p></div>
                                    <div class="winners_prize floatleft"><p class="line_size"><span style="float: left">获得</span><span class="prize">XXXXXXXXXXX</span></p></div>
                                </div>
                            </li>
                            <li>
                                <div class="info_line">
                                    <div class="winners_name floatleft"><p class="line_size"><span style="float: left">恭喜</span><span class="name">XXXXXXXXXX</span></p></div>
                                    <div class="winners_prize floatleft"><p class="line_size"><span style="float: left">获得</span><span class="prize">XXXXXXXXXXX</span></p></div>
                                </div>
                            </li>
                            <li>
                                <div class="info_line">
                                    <div class="winners_name floatleft"><p class="line_size"><span style="float: left">恭喜</span><span class="name">XXXXXXXXXX</span></p></div>
                                    <div class="winners_prize floatleft"><p class="line_size"><span style="float: left">获得</span><span class="prize">XXXXXXXXXXX</span></p></div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="info_line" style="padding-top: 0.1rem;">
                        <div class="lottery_tips bkc">查看全部中奖名单</div>
                    </div>
                    <div class="info_line border_line"></div>
                </div>

                <div class="hdsm">
                    <div class="info_title">
                        <hr width=90% size=3 color=#f2545a align=center noshade style="margin: 0 auto;">
                        <div class="title_capture">活动说明</div>
                    </div>
                    <div class="info_line">
                        <div>
                            <div style="overflow: hidden"><h2 style="float: left">活动时间</h2></div>
                            <div style="width: 100%;overflow: hidden"><p style="margin: 0.1rem;font-size: 0.12rem;float: left">2017-05-05 00:00:00 ~ 2017-05-15 00:00:00</p></div>
                        </div>
                        <div>
                            <div style="overflow: hidden"><h2 style="float: left;margin-top: 0">活动说明</h2></div>
                            <div style="width: 100%;overflow: hidden"><p style="margin: 0.1rem;font-size: 0.12rem;padding-bottom: 0.1rem;margin-bottom: 0;float: left">这个活动很好很好很好很好很不错很好很好很好很不错很好很好很好很不错很好很好很好很不错很好很好很好很不错很好很好很好很不错很好很好很好很不错很好很好很好很不错很好很好很好很不错</p></div>
                        </div>
                    </div>
                    <div class="info_line border_line"></div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="./js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript">
        //抽奖函数
        var lottery={
            restaraunts:[],   //奖品名称数组
            prizepic:[],      //奖品图片数组
            index:-1,	//当前转动到哪个位置，起点位置隐藏
            count:0,	//总共有多少个位置
            timer:0,	//setTimeout的ID，用clearTimeout清除，setTimeout次数计数；
            speed:20,	//初始转动速度
            times:0,	//转动次数
            cycle:50,	//转动基本次数：即至少需要转动多少次再进入抽奖环节
            prize:-1,	//抽奖位置
            init:function(id){        //初始化，在index为-1处增加active；
                if ($("#"+id).find(".lottery-unit").length>0) {
                    $lottery = $("#"+id);
                    $units = $lottery.find(".lottery-unit");
                    this.obj = $lottery;
                    this.count = $units.length;
                    $lottery.find(".lottery-unit-"+this.index).addClass("active");
                };
            },
            //九宫格转动
            roll:function(){
                var index = this.index;     //index为当前目录；
                var count = this.count;     //旋转的目录个数；
                var lottery = this.obj;
                $(lottery).find(".lottery-unit-"+index).removeClass("active");   //当前目录移除active；
                index += 1;                 //获取下一目录；
                if (index>count-1) {        //如果index超出目录长度则置零；
                    index = 0;
                };
                $(lottery).find(".lottery-unit-"+index).addClass("active");    //下一目录增加active；
                this.index=index;           //更新目录；
                return false;
            },
            stop:function(index){
                this.prize=index;
                return false;
            }
        };

        //添加奖品目录
        $(function () {
            lottery.restaraunts = ["50M免费流量包", "1000积分", "谢谢参与", "20闪币", "10M免费流量包", "20M免费流量包", "20积分", "30M免费流量包", "100M免费流量包"];
            lottery.prizepic = [];
            drawprizes();
        })

        //填入奖品信息
        function drawprizes() {
            for (var i = 0; i < lottery.restaraunts.length;  i++) {
                lottery.init('lottery');
                if (lottery.restaraunts[i].indexOf("M")>0) {
                   var text =  lottery.restaraunts[i].split("M");
                    $lottery.find(".lottery-unit-"+ i).find(".lottery_pn").html(text[0] + "M" + "</br>" +text[1]);
                } else {
                    $lottery.find(".lottery-unit-" + i).find(".lottery_pn").html(lottery.restaraunts[i]);
//                $lottery.find(".lottery-unit-"+ i).find(".img_sty").attr("scr","lottery.prizepic[i]");     //奖品图片地址

                }
            }
        }

        //设置权重获取奖品
        var randomConfig = [{prize_index:1,weight:5,num:1},{prize_index:2,weight:5,num:1}];   //prize_index:奖品在转盘的位置，weight：奖品权重，num：判断是否加入权重
        function weightRandom(randomConfig) {
            var randomList = [];
            for (var i in randomConfig) {
                for (var j = 0; j < randomConfig[i].weight && randomConfig[i].num != 0; j++) {
                    randomList.push(randomConfig[i].prize_index);
                }
            }
            var randomValue = randomList[Math.floor(Math.random() * randomList.length)];
            return randomValue ;
        };

        //控制转盘转动及变速函数
        function roll(){
            lottery.times += 1;                                                         //times当前转动次数；
            lottery.roll();                                                             //执行转动函数；
            if (lottery.times > lottery.cycle+10 && lottery.prize ==lottery.index) {    //如果转动次数大于基本转动次数+10
                clearTimeout(lottery.timer);                                            //且抽奖目录等于当前位置则setTimeout计数清零；
                lottery.prize=-1;                                                       //抽奖函数系统初始化；
                lottery.times=0;
                click=false;
                setTimeout(tips,1000);                                                  //提示奖品信息
                function tips() {
                    var prizename = $(".active").find(".lottery_pn").text();
                    alert(prizename);
                }
            }
            else{
                if (lottery.times<lottery.cycle) {
                    lottery.speed -= 10;
                }else if(lottery.times==lottery.cycle) {                                //转动次数等于基本转动次数
                    var index = weightRandom(randomConfig) - 1;                         //定义随机抽奖目录
                    console.log(index);
                    lottery.prize = index;
                }else{
                    if (lottery.times > lottery.cycle+10 && ((lottery.prize==0 && lottery.index==7) || lottery.prize==lottery.index+1)) {
                        lottery.speed += 110;
                    }else{
                        lottery.speed += 20;                                            //转动次数大于基本转动次数时，转动间隔逐渐变慢
                    }
                }
                if (lottery.speed<40) {                                                 //转动次数小于基本转动次数转动间隔不变
                    lottery.speed=40;
                };
                //console.log(lottery.times+'^^^^^^'+lottery.speed+'^^^^^^^'+lottery.prize);
                lottery.timer = setTimeout(roll,lottery.speed);                         //转动次数计数，根据时间间隔执行转动函数
            }
            return false;
        }

        var click=false;

        window.onload=function(){
            lottery.init('lottery');
            $("#lottery > table > tbody > tr:nth-child(2) > td:nth-child(2) > img").click(function(){
                if (click) {
                    return false;
                }else{
                    lottery.speed=50;
                    roll();
                    click=true;
                    return false;
                }
            });
        };
    </script>
</body>
</html>